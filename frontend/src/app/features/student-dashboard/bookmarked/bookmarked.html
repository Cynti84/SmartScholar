<app-dashboard-layout
  [title]="'Bookmarked Scholarships'"
  [menu]="menu"
  logoUrl="logo.png"
  (action)="onSidebarAction($event)"
>
  <section>
    <div class="saved-scholarships-page">
      <!-- Header -->
      <div class="page-header">
        <div class="header-content">
          <div class="title-section">
            <h1>
              <span class="icon">‚≠ê</span>
              Saved Scholarships
            </h1>
            <p class="subtitle">Your bookmarked opportunities for later review</p>
          </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar" *ngIf="!isLoading">
          <div class="stat-item total">
            <span class="stat-value">{{ stats.total }}</span>
            <span class="stat-label">Total Saved</span>
          </div>
          <div class="stat-item active">
            <span class="stat-value">{{ stats.active }}</span>
            <span class="stat-label">Active</span>
          </div>
          <div class="stat-item expired">
            <span class="stat-value">{{ stats.expired }}</span>
            <span class="stat-label">Expired</span>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div *ngIf="!isLoading" class="main-content">
        <!-- Filters Section -->
        <div class="filters-section" *ngIf="savedScholarships.length > 0">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input
              type="text"
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()"
              placeholder="Search saved scholarships..."
              class="search-input"
            />
          </div>

          <div class="filter-controls">
            <select
              [(ngModel)]="selectedCategory"
              (change)="onFilterChange()"
              class="filter-select"
            >
              <option value="all">All Categories</option>
              <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>

            <select [(ngModel)]="selectedStatus" (change)="onFilterChange()" class="filter-select">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="applied">Applied</option>
              <option value="expired">Expired</option>
            </select>

            <select [(ngModel)]="sortBy" (change)="onSortChange()" class="filter-select">
              <option value="saved_date">Recently Saved</option>
              <option value="deadline">Deadline (Soonest)</option>
              <option value="amount">Amount (Highest)</option>
              <option value="match_score">Match Score</option>
            </select>

            <button class="view-toggle" (click)="toggleViewMode()">
              <span class="icon">{{ viewMode === 'grid' ? '‚ò∞' : '‚ñ¶' }}</span>
            </button>
          </div>
        </div>

        <!-- Bulk Actions Bar -->
        <div class="bulk-actions-bar" *ngIf="isSelectionMode && selectedScholarshipIds.size > 0">
          <div class="selection-info">
            <span>{{ selectedScholarshipIds.size }} selected</span>
          </div>
          <div class="bulk-actions">
            <button class="btn btn-sm btn-white" (click)="selectAll()">Select All</button>
            <button class="btn btn-sm btn-white" (click)="deselectAll()">Deselect All</button>
            <button class="btn btn-sm btn-danger" (click)="bulkUnsave()">
              <span class="icon">üóëÔ∏è</span>
              Remove Selected
            </button>
          </div>
        </div>

        <!-- Scholarships Grid/List -->
        <div class="scholarships-container" [class.list-view]="viewMode === 'list'">
          <div
            *ngFor="let scholarship of filteredScholarships"
            class="scholarship-card"
            [class.selected]="selectedScholarshipIds.has(scholarship.scholarshipId)"
          >
            <!-- Selection Checkbox -->
            <div
              class="selection-checkbox"
              *ngIf="isSelectionMode"
              (click)="toggleScholarshipSelection(scholarship.scholarshipId, $event)"
            >
              <input
                type="checkbox"
                [checked]="selectedScholarshipIds.has(scholarship.scholarshipId)"
                (click)="$event.stopPropagation()"
              />
            </div>

            <!-- Status Badge -->
            <div class="status-badge" [class]="scholarship.status">
              {{ scholarship.status | uppercase }}
            </div>

            <!-- Unsave Button -->
            <button
              class="unsave-btn"
              *ngIf="!isSelectionMode"
              (click)="unsaveScholarship(scholarship, $event)"
              title="Remove from saved"
            >
              ‚òÖ
            </button>

            <!-- Card Header -->
            <div class="card-header">
              <div class="provider-section">
                <div class="provider-logo" *ngIf="scholarship.providerLogo">
                  <img [src]="scholarship.providerLogo" [alt]="scholarship.provider" />
                </div>
                <div class="provider-logo placeholder" *ngIf="!scholarship.providerLogo">
                  {{ scholarship.provider.charAt(0) }}
                </div>
                <div class="provider-info">
                  <div class="provider-name">{{ scholarship.provider }}</div>
                  <div class="saved-date">
                    Saved {{ scholarship.savedDate | date : 'MMM d, yyyy' }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Card Content -->
            <div class="card-content">
              <h3 class="scholarship-title">{{ scholarship.title }}</h3>

              <div class="scholarship-meta">
                <span class="category-badge">{{ scholarship.category }}</span>
                <span class="amount">{{ scholarship.amount }}</span>
                <span class="match-score" *ngIf="scholarship.matchScore">
                  {{ scholarship.matchScore }}% Match
                </span>
              </div>

              <p class="description">{{ scholarship.description }}</p>

              <!-- Tags -->
              <div class="tags" *ngIf="scholarship.tags && scholarship.tags.length > 0">
                <span *ngFor="let tag of scholarship.tags" class="tag">{{ tag }}</span>
              </div>

              <!-- Notes -->
              <div class="notes" *ngIf="scholarship.notes">
                <div class="notes-label">üìù Your Note:</div>
                <p class="notes-text">{{ scholarship.notes }}</p>
              </div>

              <!-- Deadline -->
              <div class="deadline-section" [class]="getDeadlineClass(scholarship.deadline)">
                <span class="deadline-icon">Deadline</span>
                <span class="deadline-text">{{ formatDeadline(scholarship.deadline) }}</span>
              </div>
            </div>

            <!-- Card Footer -->
            <div class="card-footer" *ngIf="!isSelectionMode">
              <button
                class="btn btn-outline btn-sm"
                (click)="openScholarshipDetails(scholarship, $event)"
              >
                View Details
              </button>
              <button
                class="btn btn-primary"
                [disabled]="
                  selectedScholarship?.status === 'applied' ||
                  selectedScholarship?.status === 'expired'
                "
                (click)="goToApplyPage(scholarship.scholarshipId)"
              >
                {{
                  selectedScholarship?.status === 'applied'
                    ? 'Already Applied'
                    : selectedScholarship?.status === 'expired'
                    ? 'Expired'
                    : 'Apply Now'
                }}
              </button>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredScholarships.length === 0 && !isLoading" class="empty-state">
          <div class="empty-icon">‚≠ê</div>
          <h3>
            {{
              searchTerm || selectedCategory !== 'all' || selectedStatus !== 'all'
                ? 'No Results Found'
                : 'No Saved Scholarships Yet'
            }}
          </h3>
          <p>
            {{
              searchTerm || selectedCategory !== 'all' || selectedStatus !== 'all'
                ? 'Try adjusting your filters to see more results'
                : "Start saving scholarships to keep track of opportunities you're interested in"
            }}
          </p>
          <button
            class="btn btn-primary"
            *ngIf="!searchTerm && selectedCategory === 'all' && selectedStatus === 'all'"
            routerLink="/scholarships/browse"
          >
            Browse Scholarships
          </button>
          <button
            class="btn btn-secondary"
            *ngIf="searchTerm || selectedCategory !== 'all' || selectedStatus !== 'all'"
            (click)="
              searchTerm = ''; selectedCategory = 'all'; selectedStatus = 'all'; onFilterChange()
            "
          >
            Clear Filters
          </button>
        </div>
      </div>
    </div>
  </section>
</app-dashboard-layout>

<!-- Scholarship Details Modal -->
<div
  class="scholarship-details-modal"
  *ngIf="selectedScholarship"
  (click)="closeScholarshipDetails()"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <!-- Close Button -->
    <button class="close-btn" (click)="closeScholarshipDetails()">
      <span>‚úï</span>
    </button>

    <!-- Modal Header -->
    <div class="modal-header">
      <div class="provider-section">
        <div class="provider-logo" *ngIf="selectedScholarship.providerLogo">
          <img [src]="selectedScholarship.providerLogo" [alt]="selectedScholarship.provider" />
        </div>
        <div class="provider-logo placeholder" *ngIf="!selectedScholarship.providerLogo">
          {{ selectedScholarship.provider.charAt(0) }}
        </div>
        <div class="provider-info">
          <div class="provider-name">{{ selectedScholarship.provider }}</div>
          <div class="status-badge" [class]="selectedScholarship.status">
            {{ selectedScholarship.status | uppercase }}
          </div>
        </div>
      </div>

      <h2 class="scholarship-title">{{ selectedScholarship.title }}</h2>

      <div class="scholarship-meta">
        <span class="category-badge">{{ selectedScholarship.category }}</span>
        <span class="amount">{{ selectedScholarship.amount }}</span>
        <span class="match-score" *ngIf="selectedScholarship.matchScore">
          {{ selectedScholarship.matchScore }}% Match
        </span>
      </div>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <!-- Description -->
      <div class="detail-section">
        <h3 class="section-title">Description</h3>
        <p class="section-content">{{ selectedScholarship.description }}</p>
      </div>

      <!-- Deadline -->
      <div class="detail-section" *ngIf="selectedScholarship.eligibility?.length">
        <h2>Eligibility Criteria</h2>
        <ul class="criteria-list">
          <li *ngFor="let criterion of selectedScholarship.eligibility">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="20 6 9 17 4 12" />
            </svg>
            {{ criterion }}
          </li>
        </ul>
      </div>

      <!-- Required Documents -->
      <div class="detail-section" *ngIf="selectedScholarship.requiredDocuments">
        <h3 class="section-title">Required Documents</h3>
        <ul class="documents-list">
          <li *ngFor="let doc of selectedScholarship.requiredDocuments">{{ doc }}</li>
        </ul>
      </div>

      <!-- Tags -->
      <div
        class="detail-section"
        *ngIf="selectedScholarship.tags && selectedScholarship.tags.length > 0"
      >
        <h3 class="section-title">Field of Study</h3>
        <div class="tags">
          <span *ngFor="let tag of selectedScholarship.tags" class="tag">{{ tag }}</span>
        </div>
      </div>

      <!-- Your Notes -->
      <div class="detail-section" *ngIf="selectedScholarship.notes">
        <h3 class="section-title">Your Notes</h3>
        <div class="notes-content">
          <p>{{ selectedScholarship.notes }}</p>
        </div>
      </div>

      <!-- Additional Info -->
      <div class="detail-section">
        <!-- <h3 class="section-title">Additional Information</h3> -->
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">Saved Date:</span>
            <span class="info-value">{{
              selectedScholarship.savedDate | date : 'MMM d, yyyy'
            }}</span>
          </div>
          <div class="info-item" *ngIf="selectedScholarship.applicationUrl">
            <span class="info-label">Application URL:</span>
            <a [href]="selectedScholarship.applicationUrl" target="_blank" class="info-link">
              Visit Application Page ‚Üí
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      <button class="btn btn-outline" (click)="unsaveScholarship(selectedScholarship, $event)">
        <span class="icon">‚òÖ</span>
        Remove from Saved
      </button>
      <button
        class="btn btn-primary"
        [disabled]="
          selectedScholarship.status === 'applied' || selectedScholarship.status === 'expired'
        "
        (click)="goToApplyPage(selectedScholarship!.scholarshipId)"
      >
        {{
          selectedScholarship.status === 'applied'
            ? 'Already Applied'
            : selectedScholarship.status === 'expired'
            ? 'Expired'
            : 'Apply Now'
        }}
      </button>
    </div>
  </div>
</div>

<app-confirm-modal
  *ngIf="showLogoutModal"
  title="Log out"
  message="Are you sure you want to log out of SmartScholar?"
  (confirm)="confirmLogout()"
  (cancel)="cancelLogout()"
></app-confirm-modal>
