<app-dashboard-layout
  [title]="'Bookmarked Scholarships'"
  [menu]="menu"
  logoUrl="logo.png"
  (action)="onSidebarAction($event)"
>
  <section>
    <!-- <h2>Bookmarked Works!!</h2> -->
    <div class="saved-scholarships-page">
      <!-- Header -->
      <div class="page-header">
        <div class="header-content">
          <div class="title-section">
            <h1>
              <span class="icon">‚≠ê</span>
              Saved Scholarships
            </h1>
            <p class="subtitle">Your bookmarked opportunities for later review</p>
          </div>
          <div class="header-actions">
            <button
              class="btn btn-outline"
              (click)="exportSaved()"
              *ngIf="savedScholarships.length > 0"
            >
              <span class="icon">üì•</span>
              Export
            </button>
            <button
              class="btn btn-secondary"
              (click)="toggleSelectionMode()"
              *ngIf="savedScholarships.length > 0"
            >
              <span class="icon">{{ isSelectionMode ? '‚úï' : '‚òë' }}</span>
              {{ isSelectionMode ? 'Cancel' : 'Select' }}
            </button>
          </div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar" *ngIf="!isLoading">
          <div class="stat-item total">
            <span class="stat-value">{{ stats.total }}</span>
            <span class="stat-label">Total Saved</span>
          </div>
          <div class="stat-item active">
            <span class="stat-value">{{ stats.active }}</span>
            <span class="stat-label">Active</span>
          </div>
          <div class="stat-item applied">
            <span class="stat-value">{{ stats.applied }}</span>
            <span class="stat-label">Applied</span>
          </div>
          <div class="stat-item expired">
            <span class="stat-value">{{ stats.expired }}</span>
            <span class="stat-label">Expired</span>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading your saved scholarships...</p>
      </div>

      <!-- Main Content -->
      <div *ngIf="!isLoading" class="main-content">
        <!-- Filters Section -->
        <div class="filters-section" *ngIf="savedScholarships.length > 0">
          <div class="search-box">
            <span class="search-icon">üîç</span>
            <input
              type="text"
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()"
              placeholder="Search saved scholarships..."
              class="search-input"
            />
          </div>

          <div class="filter-controls">
            <select
              [(ngModel)]="selectedCategory"
              (change)="onFilterChange()"
              class="filter-select"
            >
              <option value="all">All Categories</option>
              <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>

            <select [(ngModel)]="selectedStatus" (change)="onFilterChange()" class="filter-select">
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="applied">Applied</option>
              <option value="expired">Expired</option>
            </select>

            <select [(ngModel)]="sortBy" (change)="onSortChange()" class="filter-select">
              <option value="saved_date">Recently Saved</option>
              <option value="deadline">Deadline (Soonest)</option>
              <option value="amount">Amount (Highest)</option>
              <option value="match_score">Match Score</option>
            </select>

            <button class="view-toggle" (click)="toggleViewMode()">
              <span class="icon">{{ viewMode === 'grid' ? '‚ò∞' : '‚ñ¶' }}</span>
            </button>
          </div>
        </div>

        <!-- Bulk Actions Bar -->
        <div class="bulk-actions-bar" *ngIf="isSelectionMode && selectedScholarshipIds.size > 0">
          <div class="selection-info">
            <span>{{ selectedScholarshipIds.size }} selected</span>
          </div>
          <div class="bulk-actions">
            <button class="btn btn-sm btn-white" (click)="selectAll()">Select All</button>
            <button class="btn btn-sm btn-white" (click)="deselectAll()">Deselect All</button>
            <button class="btn btn-sm btn-danger" (click)="bulkUnsave()">
              <span class="icon">üóëÔ∏è</span>
              Remove Selected
            </button>
          </div>
        </div>

        <!-- Scholarships Grid/List -->
        <div class="scholarships-container" [class.list-view]="viewMode === 'list'">
          <div
            *ngFor="let scholarship of filteredScholarships"
            class="scholarship-card"
            [class.selected]="selectedScholarshipIds.has(scholarship.scholarshipId)"
            (click)="
              isSelectionMode
                ? toggleScholarshipSelection(scholarship.scholarshipId)
                : viewScholarship(scholarship)
            "
          >
            <!-- Selection Checkbox -->
            <div
              class="selection-checkbox"
              *ngIf="isSelectionMode"
              (click)="toggleScholarshipSelection(scholarship.scholarshipId, $event)"
            >
              <input
                type="checkbox"
                [checked]="selectedScholarshipIds.has(scholarship.scholarshipId)"
                (click)="$event.stopPropagation()"
              />
            </div>

            <!-- Status Badge -->
            <div class="status-badge" [class]="scholarship.status">
              {{ scholarship.status | uppercase }}
            </div>

            <!-- Unsave Button -->
            <button
              class="unsave-btn"
              *ngIf="!isSelectionMode"
              (click)="unsaveScholarship(scholarship, $event)"
              title="Remove from saved"
            >
              ‚òÖ
            </button>

            <!-- Card Header -->
            <div class="card-header">
              <div class="provider-section">
                <div class="provider-logo" *ngIf="scholarship.providerLogo">
                  <img [src]="scholarship.providerLogo" [alt]="scholarship.provider" />
                </div>
                <div class="provider-logo placeholder" *ngIf="!scholarship.providerLogo">
                  {{ scholarship.provider.charAt(0) }}
                </div>
                <div class="provider-info">
                  <div class="provider-name">{{ scholarship.provider }}</div>
                  <div class="saved-date">
                    Saved {{ scholarship.savedDate | date : 'MMM d, yyyy' }}
                  </div>
                </div>
              </div>
            </div>

            <!-- Card Content -->
            <div class="card-content">
              <h3 class="scholarship-title">{{ scholarship.title }}</h3>

              <div class="scholarship-meta">
                <span class="category-badge">{{ scholarship.category }}</span>
                <span class="amount">${{ scholarship.amount.toLocaleString() }}</span>
                <span class="match-score" *ngIf="scholarship.matchScore">
                  {{ scholarship.matchScore }}% Match
                </span>
              </div>

              <p class="description">{{ scholarship.description }}</p>

              <!-- Tags -->
              <div class="tags" *ngIf="scholarship.tags && scholarship.tags.length > 0">
                <span *ngFor="let tag of scholarship.tags" class="tag">{{ tag }}</span>
              </div>

              <!-- Notes -->
              <div class="notes" *ngIf="scholarship.notes">
                <div class="notes-label">üìù Your Note:</div>
                <p class="notes-text">{{ scholarship.notes }}</p>
              </div>

              <!-- Deadline -->
              <div class="deadline-section" [class]="getDeadlineClass(scholarship.deadline)">
                <span class="deadline-icon">üìÖ</span>
                <span class="deadline-text">{{ formatDeadline(scholarship.deadline) }}</span>
              </div>
            </div>

            <!-- Card Footer -->
            <div class="card-footer" *ngIf="!isSelectionMode">
              <button class="btn btn-outline btn-sm" (click)="viewScholarship(scholarship)">
                View Details
              </button>
              <button
                class="btn btn-primary btn-sm"
                [disabled]="scholarship.status === 'applied' || scholarship.status === 'expired'"
                (click)="applyToScholarship(scholarship, $event)"
              >
                {{
                  scholarship.status === 'applied'
                    ? 'Already Applied'
                    : scholarship.status === 'expired'
                    ? 'Expired'
                    : 'Apply Now'
                }}
              </button>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="filteredScholarships.length === 0 && !isLoading" class="empty-state">
          <div class="empty-icon">‚≠ê</div>
          <h3>
            {{
              searchTerm || selectedCategory !== 'all' || selectedStatus !== 'all'
                ? 'No Results Found'
                : 'No Saved Scholarships Yet'
            }}
          </h3>
          <p>
            {{
              searchTerm || selectedCategory !== 'all' || selectedStatus !== 'all'
                ? 'Try adjusting your filters to see more results'
                : "Start saving scholarships to keep track of opportunities you're interested in"
            }}
          </p>
          <button
            class="btn btn-primary"
            *ngIf="!searchTerm && selectedCategory === 'all' && selectedStatus === 'all'"
            routerLink="/scholarships/browse"
          >
            Browse Scholarships
          </button>
          <button
            class="btn btn-secondary"
            *ngIf="searchTerm || selectedCategory !== 'all' || selectedStatus !== 'all'"
            (click)="
              searchTerm = ''; selectedCategory = 'all'; selectedStatus = 'all'; onFilterChange()
            "
          >
            Clear Filters
          </button>
        </div>
        <!-- // added -->
      </div>
    </div>
  </section>
</app-dashboard-layout>

<app-confirm-modal
  *ngIf="showLogoutModal"
  title="Log out"
  message="Are you sure you want to log out of SmartScholar?"
  (confirm)="confirmLogout()"
  (cancel)="cancelLogout()"
></app-confirm-modal>
