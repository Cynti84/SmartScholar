<app-dashboard-layout
  [title]="'Post New Scholarship'"
  [menu]="menu"
  logoUrl="logo.png"
  (action)="onSidebarAction($event)"
>
  <section class="post-scholarship-container">
    <div class="form-wrapper">
      <!-- Progress Indicator -->
      <div class="progress-indicator">
        <div
          class="progress-step"
          [class.active]="currentStep === 1"
          [class.completed]="currentStep > 1"
        >
          <span class="step-number">1</span>
          <span class="step-label">Basic Info</span>
        </div>
        <div class="progress-line" [class.completed]="currentStep > 1"></div>
        <div
          class="progress-step"
          [class.active]="currentStep === 2"
          [class.completed]="currentStep > 2"
        >
          <span class="step-number">2</span>
          <span class="step-label">Details</span>
        </div>
        <div class="progress-line" [class.completed]="currentStep > 2"></div>
        <div
          class="progress-step"
          [class.active]="currentStep === 3"
          [class.completed]="currentStep > 3"
        >
          <span class="step-number">3</span>
          <span class="step-label">Categories</span>
        </div>
        <div class="progress-line" [class.completed]="currentStep > 3"></div>
        <div
          class="progress-step"
          [class.active]="currentStep === 4"
          [class.completed]="currentStep > 4"
        >
          <span class="step-number">4</span>
          <span class="step-label">Application</span>
        </div>
        <div class="progress-line" [class.completed]="currentStep > 4"></div>
        <div
          class="progress-step"
          [class.active]="currentStep === 5"
          [class.completed]="currentStep > 5"
        >
          <span class="step-number">5</span>
          <span class="step-label">Final</span>
        </div>
        <div class="progress-line" [class.completed]="currentStep > 5"></div>
        <div class="progress-step" [class.active]="currentStep === 6">
          <span class="step-number">6</span>
          <span class="step-label">Final</span>
        </div>
      </div>

      <!-- Completeness Score Widget -->
      <div class="completeness-widget" *ngIf="completenessAnalysis && showCompletenessWidget">
        <div class="widget-header">
          <div class="widget-title">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
            </svg>
            <h3>Form Completeness</h3>
          </div>
          <button
            type="button"
            class="widget-toggle"
            (click)="toggleCompletenessWidget()"
            title="Minimize"
          >
            ‚àí
          </button>
        </div>

        <div class="widget-content">
          <!-- Score Circle -->
          <div class="score-display">
            <div [class]="'score-circle ' + getScoreClass()">
              <div class="score-number">{{ completenessAnalysis.score }}</div>
              <div class="score-label">%</div>
            </div>
            <div class="score-info">
              <p class="score-description">
                {{
                  completenessAnalysis.score >= 80
                    ? 'Excellent! Almost ready to submit'
                    : completenessAnalysis.score >= 60
                    ? 'Good progress. A few more fields needed'
                    : completenessAnalysis.score >= 40
                    ? 'Getting there. Complete critical fields'
                    : 'Just getting started. Fill in required fields'
                }}
              </p>
            </div>
          </div>

          <!-- Progress Bar -->
          <div class="progress-bar-container">
            <div class="progress-bar">
              <div
                class="progress-fill"
                [style.width.%]="completenessAnalysis.score"
                [class]="getScoreClass()"
              ></div>
            </div>
            <div class="progress-stats">
              <span>‚úÖ {{ completenessAnalysis.completedFields.length }} completed</span>
              <span>‚ö†Ô∏è {{ completenessAnalysis.missingFields.length }} missing</span>
            </div>
          </div>

          <!-- Critical Missing Fields -->
          <div class="critical-missing" *ngIf="completenessAnalysis.criticalMissing.length > 0">
            <h4>üö® Critical Missing:</h4>
            <ul>
              <li *ngFor="let field of completenessAnalysis.criticalMissing">{{ field }}</li>
            </ul>
          </div>

          <!-- Suggestions -->
          <div class="suggestions" *ngIf="completenessAnalysis.suggestions.length > 0">
            <h4>üí° Suggestions:</h4>
            <ul>
              <li *ngFor="let suggestion of completenessAnalysis.suggestions.slice(0, 3)">
                {{ suggestion }}
              </li>
            </ul>
          </div>

          <!-- Missing Fields Details (Collapsible) -->
          <details
            class="missing-fields-details"
            *ngIf="completenessAnalysis.missingFields.length > 0"
          >
            <summary>
              View all missing fields ({{ completenessAnalysis.missingFields.length }})
            </summary>
            <div class="missing-fields-list">
              <div
                *ngFor="let field of completenessAnalysis.missingFields"
                class="missing-field-item"
                [class]="getImportanceClass(field.importance)"
              >
                <div class="field-header">
                  <span class="field-name">{{ field.displayName }}</span>
                  <span [class]="'importance-badge ' + getImportanceClass(field.importance)">
                    {{ field.importance }}
                  </span>
                </div>
                <p class="field-suggestion">{{ field.suggestion }}</p>
              </div>
            </div>
          </details>
        </div>
      </div>

      <!-- Minimized Widget -->
      <div class="completeness-widget-mini" *ngIf="completenessAnalysis && !showCompletenessWidget">
        <button
          type="button"
          class="widget-restore"
          (click)="toggleCompletenessWidget()"
          title="Show completeness widget"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
          </svg>
          {{ completenessAnalysis.score }}% Complete
        </button>
      </div>

      <!-- Form Container -->
      <form [formGroup]="scholarshipForm" (ngSubmit)="onSubmit()" class="scholarship-form">
        <!-- Step 1: Basic Information -->
        <div class="form-step" *ngIf="currentStep === 1">
          <div class="step-header">
            <h2>Basic Information</h2>
            <p>Let's start with the essential details about your scholarship</p>
          </div>

          <div class="form-grid">
            <div class="form-group full-width">
              <label for="title">Scholarship Title <span class="required">*</span></label>
              <input
                type="text"
                id="title"
                formControlName="title"
                placeholder="e.g., Excellence Scholarship for Engineering Students"
                class="form-control"
              />
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('title')?.invalid && scholarshipForm.get('title')?.touched
                "
              >
                Scholarship title is required
              </div>
            </div>

            <div class="form-group full-width">
              <label for="organization_name"
                >Organization Name <span class="required">*</span></label
              >
              <input
                type="text"
                id="organization_name"
                formControlName="organization_name"
                placeholder="Your organization or company name"
                class="form-control"
              />
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('organization_name')?.invalid &&
                  scholarshipForm.get('organization_name')?.touched
                "
              >
                Organization name is required
              </div>
            </div>

            <!-- ‚ú® ENHANCED: Short Summary with Polish Button -->
            <div class="form-group full-width">
              <div class="field-with-ai">
                <label for="short_summary">Short Summary <span class="required">*</span></label>
                <button
                  type="button"
                  class="btn-polish-ai"
                  (click)="polishText('short_summary', 'summary')"
                  [disabled]="
                    !scholarshipForm.get('short_summary')?.value || isPolishing('short_summary')
                  "
                  title="Polish with AI"
                >
                  <svg
                    *ngIf="!isPolishing('short_summary')"
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10" />
                    <path d="M8 14s1.5 2 4 2 4-2 4-2" />
                    <line x1="9" y1="9" x2="9.01" y2="9" />
                    <line x1="15" y1="9" x2="15.01" y2="9" />
                  </svg>
                  <span class="spinner-tiny" *ngIf="isPolishing('short_summary')"></span>
                  {{ isPolishing('short_summary') ? 'Polishing...' : '‚ú® Polish with AI' }}
                </button>
              </div>
              <textarea
                id="short_summary"
                formControlName="short_summary"
                placeholder="Brief 1-2 sentence description that will appear in search results"
                class="form-control"
                rows="3"
                maxlength="200"
              ></textarea>
              <div class="char-counter">{{ getCharacterCount('short_summary') }}/200</div>
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('short_summary')?.invalid &&
                  scholarshipForm.get('short_summary')?.touched
                "
              >
                Short summary is required
              </div>
            </div>
          </div>
        </div>

        <!-- Step 3: Categorization & Scope -->
        <div class="form-step" *ngIf="currentStep === 2">
          <div class="step-header">
            <h2>Categorization & Scope</h2>
            <p>Help students find your scholarship by categorizing it properly</p>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label for="country">Country/Location <span class="required">*</span></label>
              <select id="country" formControlName="country" class="form-control">
                <option value="">Select Country</option>
                <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
              </select>
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('country')?.invalid && scholarshipForm.get('country')?.touched
                "
              >
                Please select a country
              </div>
            </div>

            <div class="form-group">
              <label for="education_level">Education Level <span class="required">*</span></label>
              <select id="education_level" formControlName="education_level" class="form-control">
                <option value="">Select Education Level</option>
                <option *ngFor="let level of educationLevels" [value]="level">{{ level }}</option>
              </select>
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('education_level')?.invalid &&
                  scholarshipForm.get('education_level')?.touched
                "
              >
                Please select an education level
              </div>
            </div>

            <div class="form-group">
              <label for="scholarship_type">Scholarship Type <span class="required">*</span></label>
              <select id="scholarship_type" formControlName="scholarship_type" class="form-control">
                <option value="">Select Scholarship Type</option>
                <option *ngFor="let type of scholarshipTypes" [value]="type">{{ type }}</option>
              </select>
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('scholarship_type')?.invalid &&
                  scholarshipForm.get('scholarship_type')?.touched
                "
              >
                Please select a scholarship type
              </div>
            </div>

            <div class="form-group">
              <label for="min_gpa">
                Minimum GPA Requirement
                <span class="hint">(Optional)</span>
              </label>

              <select id="min_gpa" formControlName="min_gpa" class="form-control">
                <option [ngValue]="null">No minimum GPA</option>
                <option [ngValue]="2.5">2.5 and above</option>
                <option [ngValue]="3.0">3.0 and above</option>
                <option [ngValue]="3.5">3.5 and above</option>
                <option [ngValue]="3.8">3.8 and above</option>
              </select>
            </div>

            <div class="form-group full-width">
              <label>Fields of Study <span class="required">*</span></label>
              <div class="tags-container">
                <div class="selected-tags">
                  <span
                    *ngFor="let field of selectedFields"
                    class="tag selected"
                    (click)="removeField(field)"
                  >
                    {{ field }} √ó
                  </span>
                </div>
                <div class="available-tags">
                  <span
                    *ngFor="let field of getAvailableFields()"
                    class="tag available"
                    (click)="addField(field)"
                  >
                    {{ field }}
                  </span>
                </div>
              </div>
              <div
                class="error-message"
                *ngIf="
                  selectedFields.length === 0 && scholarshipForm.get('fields_of_study')?.touched
                "
              >
                Please select at least one field of study
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Description & Details -->
        <div class="form-step" *ngIf="currentStep === 3">
          <div class="step-header">
            <h2>Description & Details</h2>
            <p>Provide comprehensive information about your scholarship</p>
          </div>

          <div class="form-grid">
            <!-- ‚ú® ENHANCED: Description with Polish Button -->
            <div class="form-group full-width">
              <div class="field-with-ai">
                <label for="description">Full Description <span class="required">*</span></label>

                <button
                  type="button"
                  class="btn-polish-ai"
                  (click)="polishText('description', 'description')"
                  [disabled]="
                    !scholarshipForm.get('description')?.value || isPolishing('description')
                  "
                  title="Polish with AI"
                >
                  <svg
                    *ngIf="!isPolishing('description')"
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10" />
                    <path d="M8 14s1.5 2 4 2 4-2 4-2" />
                    <line x1="9" y1="9" x2="9.01" y2="9" />
                    <line x1="15" y1="9" x2="15.01" y2="9" />
                  </svg>
                  <span class="spinner-tiny" *ngIf="isPolishing('description')"></span>
                  {{ isPolishing('description') ? 'Polishing...' : '‚ú® Polish with AI' }}
                </button>
              </div>
              <textarea
                id="description"
                formControlName="description"
                placeholder="Detailed description of the scholarship, its purpose, and what makes it unique"
                class="form-control large-textarea"
                rows="6"
              ></textarea>
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('description')?.invalid &&
                  scholarshipForm.get('description')?.touched
                "
              >
                Full description is required
              </div>
            </div>

            <!-- ‚ú® ENHANCED: Eligibility with Polish + Generate Buttons -->
            <div class="form-group full-width">
              <div class="field-with-ai">
                <label for="eligibility_criteria"
                  >Eligibility Criteria <span class="required">*</span></label
                >
                <div class="ai-buttons-group">
                  <button
                    type="button"
                    class="btn-polish-ai"
                    (click)="polishText('eligibility_criteria', 'eligibility')"
                    [disabled]="
                      !scholarshipForm.get('eligibility_criteria')?.value ||
                      isPolishing('eligibility_criteria')
                    "
                    title="Polish with AI"
                  >
                    <span class="spinner-tiny" *ngIf="isPolishing('eligibility_criteria')"></span>
                    {{ isPolishing('eligibility_criteria') ? 'Polishing...' : '‚ú® Polish' }}
                  </button>
                  <button
                    type="button"
                    class="btn-generate-ai"
                    (click)="generateSuggestion('eligibility_criteria', 'eligibility')"
                    [disabled]="isGenerating('eligibility_criteria')"
                    title="Generate template with AI"
                  >
                    <span class="spinner-tiny" *ngIf="isGenerating('eligibility_criteria')"></span>
                    {{
                      isGenerating('eligibility_criteria')
                        ? 'Generating...'
                        : 'üéØ Generate Template'
                    }}
                  </button>
                </div>
              </div>
              <textarea
                id="eligibility_criteria"
                formControlName="eligibility_criteria"
                placeholder="Who can apply? Include academic requirements, age limits, nationality, etc."
                class="form-control"
                rows="4"
              ></textarea>
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('eligibility_criteria')?.invalid &&
                  scholarshipForm.get('eligibility_criteria')?.touched
                "
              >
                Eligibility criteria is required
              </div>
            </div>

            <!-- ‚ú® ENHANCED: Benefits with Polish + Generate Buttons -->
            <div class="form-group full-width">
              <div class="field-with-ai">
                <label for="benefits"
                  >Benefits & Funding Coverage <span class="required">*</span></label
                >
                <div class="ai-buttons-group">
                  <button
                    type="button"
                    class="btn-polish-ai"
                    (click)="polishText('benefits', 'benefits')"
                    [disabled]="!scholarshipForm.get('benefits')?.value || isPolishing('benefits')"
                    title="Polish with AI"
                  >
                    <span class="spinner-tiny" *ngIf="isPolishing('benefits')"></span>
                    {{ isPolishing('benefits') ? 'Polishing...' : '‚ú® Polish' }}
                  </button>
                  <button
                    type="button"
                    class="btn-generate-ai"
                    (click)="generateSuggestion('benefits', 'benefits')"
                    [disabled]="isGenerating('benefits')"
                    title="Generate template with AI"
                  >
                    <span class="spinner-tiny" *ngIf="isGenerating('benefits')"></span>
                    {{ isGenerating('benefits') ? 'Generating...' : 'üéØ Generate Template' }}
                  </button>
                </div>
              </div>
              <textarea
                id="benefits"
                formControlName="benefits"
                placeholder="What does this scholarship cover? (tuition, living expenses, travel, stipend, etc.)"
                class="form-control"
                rows="4"
              ></textarea>
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('benefits')?.invalid &&
                  scholarshipForm.get('benefits')?.touched
                "
              >
                Benefits information is required
              </div>
            </div>

            <div class="form-group">
              <label for="deadline">Application Deadline <span class="required">*</span></label>
              <input
                type="date"
                id="deadline"
                formControlName="deadline"
                class="form-control"
                [min]="minDate"
              />
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('deadline')?.invalid &&
                  scholarshipForm.get('deadline')?.touched
                "
              >
                Please select a valid future date
              </div>
            </div>
          </div>
        </div>

        <!-- Step 4: Enhanced Eligibility -->
        <div class="form-step" *ngIf="currentStep === 4">
          <div class="step-header">
            <h2>Eligibility Enhancements</h2>
            <p>Specify additional eligibility criteria for students</p>
          </div>

          <div class="form-grid">
            <!-- Age Range -->
            <div class="form-group">
              <label for="min_age">Minimum Age</label>
              <input
                type="number"
                id="min_age"
                formControlName="min_age"
                class="form-control"
                min="0"
              />
            </div>

            <div class="form-group">
              <label for="max_age">Maximum Age</label>
              <input
                type="number"
                id="max_age"
                formControlName="max_age"
                class="form-control"
                min="0"
              />
            </div>

            <!-- Gender -->
            <div class="form-group">
              <label>Gender</label>
              <div class="radio-group">
                <label class="radio-option">
                  <input type="radio" formControlName="gender" value="male" /> Male
                </label>
                <label class="radio-option">
                  <input type="radio" formControlName="gender" value="female" /> Female
                </label>
                <label class="radio-option">
                  <input type="radio" formControlName="gender" value="any" /> Any
                </label>
              </div>
            </div>

            <!-- Income Level -->
            <div class="form-group">
              <label for="income_level">Income Level</label>
              <select id="income_level" formControlName="income_level" class="form-control">
                <option value="">Select Income Level</option>
                <option *ngFor="let level of incomeLevels" [value]="level">{{ level }}</option>
              </select>
            </div>

            <!-- Eligible Countries -->
            <div class="form-group full-width">
              <label>Eligible Countries</label>
              <div class="tags-container">
                <div class="selected-tags">
                  <span
                    *ngFor="let country of selectedEligibilityCountries"
                    class="tag selected"
                    (click)="removeEligibilityCountry(country)"
                  >
                    {{ country }} √ó
                  </span>
                </div>
                <div class="available-tags">
                  <span
                    *ngFor="let country of getAvailableEligibilityCountries()"
                    class="tag available"
                    (click)="addEligibilityCountry(country)"
                  >
                    {{ country }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Disability -->
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="requires_disability" /> Must be a student
                with a disability
              </label>
            </div>
          </div>
        </div>

        <!-- Step 5: Application Information -->
        <div class="form-step" *ngIf="currentStep === 5">
          <div class="step-header">
            <h2>Application Information</h2>
            <p>Provide details on how students can apply</p>
          </div>

          <div class="form-grid">
            <div class="form-group full-width">
              <label for="applicationLink">Application Link <span class="required">*</span></label>
              <input
                type="url"
                id="application_link"
                formControlName="application_link"
                placeholder="https://example.com/apply"
                class="form-control"
              />
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('application_link')?.invalid &&
                  scholarshipForm.get('application_link')?.touched
                "
              >
                Please provide a valid application URL
              </div>
            </div>

            <!-- ‚ú® ENHANCED: Application Instructions with Polish + Generate Buttons -->
            <div class="form-group full-width">
              <div class="field-with-ai">
                <label for="application_instructions"
                  >Application Instructions <span class="required">*</span></label
                >
                <div class="ai-buttons-group">
                  <button
                    type="button"
                    class="btn-polish-ai"
                    (click)="polishText('application_instructions', 'instructions')"
                    [disabled]="
                      !scholarshipForm.get('application_instructions')?.value ||
                      isPolishing('application_instructions')
                    "
                    title="Polish with AI"
                  >
                    <span
                      class="spinner-tiny"
                      *ngIf="isPolishing('application_instructions')"
                    ></span>
                    {{ isPolishing('application_instructions') ? 'Polishing...' : '‚ú® Polish' }}
                  </button>
                  <button
                    type="button"
                    class="btn-generate-ai"
                    (click)="generateSuggestion('application_instructions', 'instructions')"
                    [disabled]="isGenerating('application_instructions')"
                    title="Generate template with AI"
                  >
                    <span
                      class="spinner-tiny"
                      *ngIf="isGenerating('application_instructions')"
                    ></span>
                    {{
                      isGenerating('application_instructions')
                        ? 'Generating...'
                        : 'üéØ Generate Template'
                    }}
                  </button>
                </div>
              </div>
              <textarea
                id="application_instructions"
                formControlName="application_instructions"
                placeholder="Step-by-step instructions and required documents for application"
                class="form-control large-textarea"
                rows="6"
              ></textarea>
              <div
                class="error-message"
                *ngIf="
                  scholarshipForm.get('application_instructions')?.invalid &&
                  scholarshipForm.get('application_instructions')?.touched
                "
              >
                Application instructions are required
              </div>
            </div>

            <div class="form-group">
              <label for="contact_email">Contact Email</label>
              <input
                type="email"
                id="contact_email"
                formControlName="contact_email"
                placeholder="contact@organization.com"
                class="form-control"
              />
            </div>

            <div class="form-group">
              <label for="contact_phone">Contact Phone</label>
              <input
                type="tel"
                id="contact_phone"
                formControlName="contact_phone"
                placeholder="+1 (555) 123-4567"
                class="form-control"
              />
            </div>
          </div>
        </div>

        <!-- Step 6: Attachments & Final -->
        <div class="form-step" *ngIf="currentStep === 6">
          <div class="step-header">
            <h2>Attachments & Final Details</h2>
            <p>Upload supporting documents and add any final details</p>
          </div>

          <div class="form-grid">
            <!-- File Uploads -->
            <div class="form-group full-width">
              <label>Upload Flyer / Brochure (PDF/Image)</label>
              <div
                class="file-upload-area"
                (click)="flyerInput.click()"
                [class.has-file]="selectedFlyer"
              >
                <input
                  #flyerInput
                  type="file"
                  (change)="onFileSelect($event, 'flyer')"
                  accept=".pdf,.jpg,.jpeg,.png"
                  hidden
                />
                <div class="upload-content" *ngIf="!selectedFlyer">
                  <div class="upload-icon">
                    <mat-icon style="font-size: 30px; color: #0288d1"> description </mat-icon>
                  </div>
                  <p>Click to upload flyer or brochure</p>
                  <small>PDF, JPG, PNG (Max 5MB)</small>
                </div>
                <div class="upload-content" *ngIf="selectedFlyer">
                  <div class="upload-icon success">
                    <mat-icon style="font-size: 30px; color: #2e7d32"> check_circle </mat-icon>
                  </div>
                  <p>{{ selectedFlyer.name }}</p>
                  <button
                    type="button"
                    class="remove-file"
                    (click)="removeFile('flyer'); $event.stopPropagation()"
                  >
                    Remove
                  </button>
                </div>
              </div>
            </div>

            <div class="form-group full-width">
              <label>Upload Banner / Logo</label>
              <div
                class="file-upload-area"
                (click)="bannerInput.click()"
                [class.has-file]="selectedBanner"
              >
                <input
                  #bannerInput
                  type="file"
                  (change)="onFileSelect($event, 'banner')"
                  accept=".jpg,.jpeg,.png"
                  hidden
                />
                <div class="upload-content" *ngIf="!selectedBanner">
                  <div class="upload-icon">
                    <mat-icon style="font-size: 30px; color: #6a1b9a"> image </mat-icon>
                  </div>
                  <p>Click to upload banner or logo</p>
                  <small>JPG, PNG (Max 2MB)</small>
                </div>
                <div class="upload-content" *ngIf="selectedBanner">
                  <div class="upload-icon success">
                    <mat-icon style="font-size: 30px; color: #2e7d32"> check_circle </mat-icon>
                  </div>
                  <p>{{ selectedBanner.name }}</p>
                  <button
                    type="button"
                    class="remove-file"
                    (click)="removeFile('banner'); $event.stopPropagation()"
                  >
                    Remove
                  </button>
                </div>
              </div>
            </div>

            <div class="form-group full-width">
              <label>Verification Documents</label>
              <div
                class="file-upload-area"
                (click)="verificationInput.click()"
                [class.has-file]="selectedVerificationDocs.length > 0"
              >
                <input
                  #verificationInput
                  type="file"
                  (change)="onFileSelect($event, 'verification')"
                  accept=".pdf,.doc,.docx"
                  multiple
                  hidden
                />
                <div class="upload-content" *ngIf="selectedVerificationDocs.length === 0">
                  <div class="upload-icon">
                    <mat-icon style="font-size: 30px; color: #0288d1"> description </mat-icon>
                  </div>
                  <p>Click to upload verification documents</p>
                  <small>PDF, DOC, DOCX (Multiple files allowed)</small>
                </div>
                <div class="upload-content" *ngIf="selectedVerificationDocs.length > 0">
                  <div class="upload-icon success">
                    <mat-icon style="font-size: 30px; color: #2e7d32"> check_circle </mat-icon>
                  </div>
                  <p>{{ selectedVerificationDocs.length }} file(s) selected</p>
                  <button
                    type="button"
                    class="remove-file"
                    (click)="removeFile('verification'); $event.stopPropagation()"
                  >
                    Remove All
                  </button>
                </div>
              </div>
            </div>

            <div class="form-group full-width">
              <label for="admin_notes">Notes for Admin</label>
              <textarea
                id="adminNotes"
                formControlName="admin_notes"
                placeholder="Any special instructions or notes for the admin during verification"
                class="form-control"
                rows="4"
              ></textarea>
            </div>
          </div>

          <!-- Final Review -->
          <div class="review-section">
            <h3>Review Your Scholarship</h3>
            <div class="review-grid">
              <div class="review-item">
                <strong>Title:</strong> {{ scholarshipForm.get('title')?.value || 'Not provided' }}
              </div>
              <div class="review-item">
                <strong>Organization:</strong>
                {{ scholarshipForm.get('organization_name')?.value || 'Not provided' }}
              </div>
              <div class="review-item">
                <strong>Deadline:</strong> {{ scholarshipForm.get('deadline')?.value || 'Not set' }}
              </div>
              <div class="review-item">
                <strong>Country:</strong>
                {{ scholarshipForm.get('country')?.value || 'Not selected' }}
              </div>
              <div class="review-item">
                <strong>Education Level:</strong>
                {{ scholarshipForm.get('education_level')?.value || 'Not selected' }}
              </div>
              <div class="review-item">
                <strong>Fields of Study:</strong> {{ selectedFields.join(', ') || 'None selected' }}
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="previousStep()"
            *ngIf="currentStep > 1"
          >
            Previous
          </button>

          <button
            type="button"
            class="btn btn-outline"
            (click)="saveDraft()"
            *ngIf="currentStep < 6"
          >
            Save as Draft
          </button>

          <button
            type="button"
            class="btn btn-primary"
            (click)="nextStep()"
            *ngIf="currentStep < 6"
            [disabled]="!isCurrentStepValid()"
          >
            Next Step
          </button>

          <button
            type="submit"
            class="btn btn-success"
            *ngIf="currentStep === 6"
            [disabled]="!scholarshipForm.valid"
          >
            <span *ngIf="!isSubmitting">Post Scholarship</span>
            <span *ngIf="isSubmitting">
              <div class="spinner"></div>
              Posting...
            </span>
          </button>
        </div>
      </form>
    </div>
  </section>
</app-dashboard-layout>

<!-- ‚ú® POLISH TEXT COMPARISON MODAL -->
<div class="modal-overlay" *ngIf="polishComparison?.show" (click)="rejectPolishedText()">
  <div class="modal-content polish-modal" (click)="$event.stopPropagation()">
    <!-- Header with gradient -->
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">‚ú®</div>
        <div>
          <h3>AI-Polished Text</h3>
          <p class="header-subtitle">Review the improvements below</p>
        </div>
      </div>
      <button type="button" class="close-btn" (click)="rejectPolishedText()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <!-- Improvements List -->
      <div
        class="improvements-section"
        *ngIf="polishComparison!.improvements && polishComparison!.improvements.length > 0"
      >
        <h4>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          What was improved
        </h4>
        <ul class="improvements-list">
          <li *ngFor="let improvement of polishComparison?.improvements">
            <span class="improvement-dot"></span>
            <span>{{ improvement }}</span>
          </li>
        </ul>
      </div>

      <!-- Text Comparison -->
      <div class="text-comparison">
        <div class="comparison-column">
          <div class="column-header original-header">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
            Original Text
          </div>
          <div class="text-box original-text">
            {{ polishComparison?.original }}
          </div>
        </div>

        <div class="comparison-arrow">
          <div class="arrow-circle">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
        </div>

        <div class="comparison-column">
          <div class="column-header polished-header">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            Polished Text
          </div>
          <div class="text-box polished-text">
            {{ polishComparison?.polished }}
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="rejectPolishedText()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        Keep Original
      </button>
      <button type="button" class="btn btn-primary" (click)="acceptPolishedText()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        Use Polished Version
      </button>
    </div>
  </div>
</div>

<app-confirm-modal
  *ngIf="showLogoutModal"
  title="Log out"
  message="Are you sure you want to log out of SmartScholar?"
  (confirm)="confirmLogout()"
  (cancel)="cancelLogout()"
></app-confirm-modal>
