<app-dashboard-layout
  [title]="'Manage Scholarships'"
  [menu]="menu"
  logoUrl="logo.png"
  (action)="onSidebarAction($event)"
>
  <section class="manage-scholarships-container">
    <!-- Header Section -->
    <div class="header-section">
      <div class="header-content">
        <h1>My Scholarships</h1>
        <p>Manage and track all your posted scholarships</p>
      </div>
      <button class="btn btn-primary" (click)="navigateToPost()">
        <span class="icon">â•</span>
        Post New Scholarship
      </button>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card total">
        <div class="card-content">
          <div class="card-icon">ğŸ“š</div>
          <div class="card-data">
            <span class="card-value">{{ getTotalScholarships() }}</span>
            <span class="card-label">Total Scholarships</span>
          </div>
        </div>
      </div>

      <div class="summary-card pending">
        <div class="card-content">
          <div class="card-icon">â³</div>
          <div class="card-data">
            <span class="card-value">{{ getScholarshipsByStatus('pending').length }}</span>
            <span class="card-label">Pending Review</span>
          </div>
        </div>
      </div>

      <div class="summary-card approved">
        <div class="card-content">
          <div class="card-icon">âœ…</div>
          <div class="card-data">
            <span class="card-value">{{ getScholarshipsByStatus('approved').length }}</span>
            <span class="card-label">Approved</span>
          </div>
        </div>
      </div>

      <div class="summary-card applications">
        <div class="card-content">
          <div class="card-icon">ğŸ‘¥</div>
          <div class="card-data">
            <span class="card-value">{{ getTotalApplications() }}</span>
            <span class="card-label">Total Applications</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters & Search -->
    <div class="filters-section">
      <div class="search-container">
        <div class="search-input-wrapper">
          <span class="search-icon">ğŸ”</span>
          <input
            type="text"
            placeholder="Search scholarships..."
            [(ngModel)]="searchTerm"
            (input)="applyFilters()"
            class="search-input"
          />
        </div>
      </div>

      <div class="filter-controls">
        <select [(ngModel)]="statusFilter" (change)="applyFilters()" class="filter-select">
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="approved">Approved</option>
          <option value="rejected">Rejected</option>
          <option value="expired">Expired</option>
        </select>

        <select [(ngModel)]="sortBy" (change)="applyFilters()" class="filter-select">
          <option value="dateCreated">Sort by Date Created</option>
          <option value="title">Sort by Title</option>
          <option value="applications">Sort by Applications</option>
          <option value="views">Sort by Views</option>
        </select>

        <button class="filter-btn" [class.active]="showExpiredOnly" (click)="toggleExpiredOnly()">
          <span class="icon">â°</span>
          {{ showExpiredOnly ? 'Show All' : 'Expired Only' }}
        </button>
      </div>
    </div>

    <!-- Scholarships Table -->
    <div class="table-container">
      <div class="table-header">
        <h3>
          {{ filteredScholarships.length }} Scholarship{{
            filteredScholarships.length !== 1 ? 's' : ''
          }}
        </h3>
        <div class="view-controls">
          <button
            class="view-btn"
            [class.active]="viewMode === 'table'"
            (click)="setViewMode('table')"
          >
            <span class="icon">ğŸ“‹</span>
            Table
          </button>
          <button
            class="view-btn"
            [class.active]="viewMode === 'cards'"
            (click)="setViewMode('cards')"
          >
            <span class="icon">ğŸ“±</span>
            Cards
          </button>
        </div>
      </div>

      <!-- Table View -->
      <div class="table-wrapper" *ngIf="viewMode === 'table'">
        <table class="scholarships-table">
          <thead>
            <tr>
              <th>Scholarship Details</th>
              <th>Status</th>
              <th>Deadline</th>
              <th>Analytics</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let scholarship of filteredScholarships; trackBy: trackByScholarshipId">
              <td class="scholarship-details">
                <div class="scholarship-info">
                  <h4 class="scholarship-title">{{ scholarship.title }}</h4>
                  <p class="scholarship-summary">{{ scholarship.shortSummary }}</p>
                  <div class="scholarship-meta">
                    <span class="meta-item">
                      <span class="icon">ğŸŒ</span>
                      {{ scholarship.country }}
                    </span>
                    <span class="meta-item">
                      <span class="icon">ğŸ“</span>
                      {{ scholarship.educationLevel }}
                    </span>
                    <span class="meta-item">
                      <span class="icon">ğŸ“…</span>
                      Created {{ scholarship.dateCreated | date : 'MMM dd, yyyy' }}
                    </span>
                  </div>
                </div>
              </td>

              <td class="status-cell">
                <span class="status-badge" [class]="getStatusClass(scholarship.status)">
                  {{ scholarship.status }}
                </span>
              </td>

              <td class="deadline-cell">
                <div class="deadline-info">
                  <span class="deadline-date">{{
                    scholarship.applicationDeadline | date : 'MMM dd, yyyy'
                  }}</span>
                  <span
                    class="deadline-status"
                    [class.expired]="isExpired(scholarship.applicationDeadline)"
                    [class.soon]="isDeadlineSoon(scholarship.applicationDeadline)"
                  >
                    {{ getDeadlineText(scholarship.applicationDeadline) }}
                  </span>
                </div>
              </td>

              <td class="analytics-cell">
                <div class="analytics-grid">
                  <div class="analytics-item">
                    <span class="analytics-icon">ğŸ‘ï¸</span>
                    <span class="analytics-value">{{ scholarship.analytics.views }}</span>
                    <span class="analytics-label">Views</span>
                  </div>
                  <div class="analytics-item">
                    <span class="analytics-icon">ğŸ”–</span>
                    <span class="analytics-value">{{ scholarship.analytics.bookmarks }}</span>
                    <span class="analytics-label">Saved</span>
                  </div>
                  <div class="analytics-item">
                    <span class="analytics-icon">ğŸ“</span>
                    <span class="analytics-value">{{ scholarship.analytics.applications }}</span>
                    <span class="analytics-label">Applied</span>
                  </div>
                </div>
              </td>

              <td class="actions-cell">
                <div class="action-buttons">
                  <button
                    class="action-btn view"
                    (click)="viewScholarship(scholarship)"
                    title="View Details"
                  >
                    ğŸ“„
                  </button>
                  <button
                    class="action-btn edit"
                    (click)="editScholarship(scholarship)"
                    title="Edit Scholarship"
                    [disabled]="scholarship.status === 'rejected'"
                  >
                    âœï¸
                  </button>
                  <button
                    class="action-btn delete"
                    (click)="deleteScholarship(scholarship)"
                    title="Delete Scholarship"
                  >
                    âŒ
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="filteredScholarships.length === 0">
          <div class="empty-icon">ğŸ“š</div>
          <h3>No scholarships found</h3>
          <p *ngIf="searchTerm || statusFilter">Try adjusting your filters or search terms</p>
          <p *ngIf="!searchTerm && !statusFilter">You haven't posted any scholarships yet</p>
          <button
            class="btn btn-primary"
            (click)="navigateToPost()"
            *ngIf="!searchTerm && !statusFilter"
          >
            Post Your First Scholarship
          </button>
        </div>
      </div>

      <!-- Card View -->
      <div class="cards-container" *ngIf="viewMode === 'cards'">
        <!-- card view unchanged, same class names and structure -->
        <ng-container
          *ngFor="let scholarship of filteredScholarships; trackBy: trackByScholarshipId"
        >
          <ng-container
            *ngTemplateOutlet="cardTemplate; context: { $implicit: scholarship }"
          ></ng-container>
        </ng-container>

        <!-- Empty State for Cards -->
        <div class="empty-state" *ngIf="filteredScholarships.length === 0">
          <div class="empty-icon">ğŸ“š</div>
          <h3>No scholarships found</h3>
          <p *ngIf="searchTerm || statusFilter">Try adjusting your filters or search terms</p>
          <p *ngIf="!searchTerm && !statusFilter">You haven't posted any scholarships yet</p>
          <button
            class="btn btn-primary"
            (click)="navigateToPost()"
            *ngIf="!searchTerm && !statusFilter"
          >
            Post Your First Scholarship
          </button>
        </div>
      </div>
    </div>

    <!-- Bulk Actions -->
    <div class="bulk-actions" *ngIf="selectedScholarships.length > 0">
      <div class="bulk-info">
        <span
          >{{ selectedScholarships.length }} scholarship{{
            selectedScholarships.length !== 1 ? 's' : ''
          }}
          selected</span
        >
      </div>
      <div class="bulk-buttons">
        <button class="btn btn-outline" (click)="clearSelection()">Clear Selection</button>
        <button class="btn btn-danger" (click)="bulkDelete()">Delete Selected</button>
      </div>
    </div>

    <!-- View & Edit Modals unchanged, just TS hooks intact -->

    <!-- View Details Modal -->
    <div class="modal-overlay" *ngIf="showViewModal" (click)="closeViewModal()">
      <div class="modal-container view-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>ğŸ“„ Scholarship Details</h2>
          <button class="modal-close" (click)="closeViewModal()">âœ•</button>
        </div>
        <div class="modal-body" *ngIf="currentScholarship">
          <div class="detail-section">
            <div class="detail-header">
              <h3>{{ currentScholarship.title }}</h3>
              <span class="status-badge" [class]="getStatusClass(currentScholarship.status)">
                {{ currentScholarship.status }}
              </span>
            </div>
          </div>
          <div class="detail-section">
            <h4 class="section-title">ğŸ“ Summary</h4>
            <p class="detail-text">{{ currentScholarship.shortSummary }}</p>
          </div>
          <div class="detail-grid">
            <div class="detail-item">
              <label class="detail-label">ğŸ¢ Organization</label>
              <p class="detail-value">{{ currentScholarship.organizationName }}</p>
            </div>
            <div class="detail-item">
              <label class="detail-label">ğŸŒ Country</label>
              <p class="detail-value">{{ currentScholarship.country }}</p>
            </div>
            <div class="detail-item">
              <label class="detail-label">ğŸ“ Education Level</label>
              <p class="detail-value">{{ currentScholarship.educationLevel }}</p>
            </div>
            <div class="detail-item">
              <label class="detail-label">ğŸ’° Scholarship Type</label>
              <p class="detail-value">{{ currentScholarship.scholarshipType }}</p>
            </div>
          </div>
          <div class="detail-section">
            <h4 class="section-title">ğŸ“š Fields of Study</h4>
            <div class="fields-tags">
              <span class="field-tag" *ngFor="let field of currentScholarship.fieldsOfStudy">
                {{ field }}
              </span>
            </div>
          </div>
          <div class="detail-section">
            <h4 class="section-title">ğŸ“… Important Dates</h4>
            <div class="dates-info">
              <div class="date-item">
                <span class="date-label">Application Deadline:</span>
                <span class="date-value">{{
                  currentScholarship.applicationDeadline | date : 'MMMM dd, yyyy'
                }}</span>
                <span
                  class="deadline-status"
                  [class.expired]="isExpired(currentScholarship.applicationDeadline)"
                  [class.soon]="isDeadlineSoon(currentScholarship.applicationDeadline)"
                >
                  ({{ getDeadlineText(currentScholarship.applicationDeadline) }})
                </span>
              </div>
              <div class="date-item">
                <span class="date-label">Date Created:</span>
                <span class="date-value">{{
                  currentScholarship.dateCreated | date : 'MMMM dd, yyyy'
                }}</span>
              </div>
            </div>
          </div>
          <div class="detail-section">
            <h4 class="section-title">ğŸ“Š Analytics</h4>
            <div class="analytics-display">
              <div class="analytics-card">
                <div class="analytics-icon">ğŸ‘ï¸</div>
                <div class="analytics-info">
                  <span class="analytics-number">{{ currentScholarship.analytics.views }}</span>
                  <span class="analytics-text">Total Views</span>
                </div>
              </div>
              <div class="analytics-card">
                <div class="analytics-icon">ğŸ”–</div>
                <div class="analytics-info">
                  <span class="analytics-number">{{ currentScholarship.analytics.bookmarks }}</span>
                  <span class="analytics-text">Bookmarks</span>
                </div>
              </div>
              <div class="analytics-card">
                <div class="analytics-icon">ğŸ“</div>
                <div class="analytics-info">
                  <span class="analytics-number">{{
                    currentScholarship.analytics.applications
                  }}</span>
                  <span class="analytics-text">Applications</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" (click)="closeViewModal()">Close</button>
          <button
            class="btn btn-primary"
            (click)="editScholarship(currentScholarship!); closeViewModal()"
            [disabled]="currentScholarship?.status === 'rejected'"
          >
            âœï¸ Edit Scholarship
          </button>
        </div>
      </div>
    </div>
    <!-- Edit Modal -->
    <div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
      <div class="modal-container edit-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>âœï¸ Edit Scholarship</h2>
          <button class="modal-close" (click)="closeEditModal()">âœ•</button>
        </div>
        <div class="modal-body" *ngIf="editingScholarship">
          <form class="edit-form">
            <div class="form-group">
              <label class="form-label" for="edit-title">
                Scholarship Title <span class="required">*</span>
              </label>
              <input
                type="text"
                id="edit-title"
                class="form-input"
                [(ngModel)]="editingScholarship.title"
                name="title"
                placeholder="Enter scholarship title"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label" for="edit-summary">
                Short Summary <span class="required">*</span>
              </label>
              <textarea
                id="edit-summary"
                class="form-textarea"
                [(ngModel)]="editingScholarship.shortSummary"
                name="summary"
                rows="3"
                placeholder="Brief description of the scholarship"
                required
              ></textarea>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="edit-organization">
                  Organization Name <span class="required">*</span>
                </label>
                <input
                  type="text"
                  id="edit-organization"
                  class="form-input"
                  [(ngModel)]="editingScholarship.organizationName"
                  name="organization"
                  placeholder="Organization name"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label" for="edit-country">
                  Country <span class="required">*</span>
                </label>
                <input
                  type="text"
                  id="edit-country"
                  class="form-input"
                  [(ngModel)]="editingScholarship.country"
                  name="country"
                  placeholder="Country"
                  required
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="edit-education">
                  Education Level <span class="required">*</span>
                </label>
                <select
                  id="edit-education"
                  class="form-select"
                  [(ngModel)]="editingScholarship.educationLevel"
                  name="educationLevel"
                  required
                >
                  <option value="Undergraduate / Bachelor's">Undergraduate / Bachelor's</option>
                  <option value="Graduate / Master's">Graduate / Master's</option>
                  <option value="Doctorate / PhD">Doctorate / PhD</option>
                  <option value="Any Level">Any Level</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label" for="edit-type">
                  Scholarship Type <span class="required">*</span>
                </label>
                <select
                  id="edit-type"
                  class="form-select"
                  [(ngModel)]="editingScholarship.scholarshipType"
                  name="scholarshipType"
                  required
                >
                  <option value="Fully Funded">Fully Funded</option>
                  <option value="Partial Funding">Partial Funding</option>
                  <option value="Merit-based">Merit-based</option>
                  <option value="Need-based">Need-based</option>
                  <option value="Fellowship">Fellowship</option>
                  <option value="Research Grant">Research Grant</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="edit-deadline">
                Application Deadline <span class="required">*</span>
              </label>
              <input
                type="date"
                id="edit-deadline"
                class="form-input"
                [value]="formatDateForInput(editingScholarship.applicationDeadline)"
                (change)="updateDeadline($any($event.target).value)"
                name="deadline"
                required
              />
            </div>
            <div class="form-group">
              <label class="form-label"> Fields of Study </label>
              <div class="fields-edit">
                <div
                  class="field-tag-editable"
                  *ngFor="let field of editingScholarship.fieldsOfStudy; let i = index"
                >
                  {{ field }}
                  <button
                    type="button"
                    class="remove-field"
                    (click)="editingScholarship.fieldsOfStudy.splice(i, 1)"
                  >
                    âœ•
                  </button>
                </div>
              </div>
              <p class="form-hint">Note: Field management can be enhanced later</p>
            </div>
            <div class="form-group">
              <label class="form-label">Current Status</label>
              <div class="status-display">
                <span class="status-badge" [class]="getStatusClass(editingScholarship.status)">
                  {{ editingScholarship.status }}
                </span>
                <p class="form-hint">Status is managed by administrators</p>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" (click)="closeEditModal()">Cancel</button>
          <button class="btn btn-primary" (click)="saveEditedScholarship()">ğŸ’¾ Save Changes</button>
        </div>
      </div>
    </div>
  </section>
</app-dashboard-layout>

<app-confirm-modal
  *ngIf="showLogoutModal"
  title="Log out"
  message="Are you sure you want to log out of SmartScholar?"
  (confirm)="confirmLogout()"
  (cancel)="cancelLogout()"
></app-confirm-modal>

<!-- Card template for ngTemplateOutlet (reuses original classes for SCSS) -->
<ng-template #cardTemplate let-scholarship>
  <div class="scholarship-card">
    <div class="card-header">
      <div class="card-title-section">
        <h4 class="card-title">{{ scholarship.title }}</h4>
        <span class="status-badge small" [class]="getStatusClass(scholarship.status)">
          {{ scholarship.status }}
        </span>
      </div>
      <div class="card-actions">
        <button class="action-btn view" (click)="viewScholarship(scholarship)" title="View">
          ğŸ“„
        </button>
        <button
          class="action-btn edit"
          (click)="editScholarship(scholarship)"
          title="Edit"
          [disabled]="scholarship.status === 'rejected'"
        >
          âœï¸
        </button>
        <button class="action-btn delete" (click)="deleteScholarship(scholarship)" title="Delete">
          âŒ
        </button>
      </div>
    </div>

    <div class="card-content">
      <p class="card-summary">{{ scholarship.shortSummary }}</p>
      <div class="card-meta">
        <span class="meta-item">ğŸŒ {{ scholarship.country }}</span>
        <span class="meta-item">ğŸ“ {{ scholarship.educationLevel }}</span>
      </div>
      <div class="card-deadline">
        <span class="deadline-label">Deadline:</span>
        <span class="deadline-date">{{
          scholarship.applicationDeadline | date : 'MMM dd, yyyy'
        }}</span>
        <span
          class="deadline-status"
          [class.expired]="isExpired(scholarship.applicationDeadline)"
          [class.soon]="isDeadlineSoon(scholarship.applicationDeadline)"
        >
          ({{ getDeadlineText(scholarship.applicationDeadline) }})
        </span>
      </div>
    </div>

    <div class="card-footer">
      <div class="card-analytics">
        <div class="analytics-item">
          <span class="analytics-icon">ğŸ‘ï¸</span>
          <span class="analytics-value">{{ scholarship.analytics.views }}</span>
        </div>
        <div class="analytics-item">
          <span class="analytics-icon">ğŸ”–</span>
          <span class="analytics-value">{{ scholarship.analytics.bookmarks }}</span>
        </div>
        <div class="analytics-item">
          <span class="analytics-icon">ğŸ“</span>
          <span class="analytics-value">{{ scholarship.analytics.applications }}</span>
        </div>
      </div>
      <span class="created-date">{{ scholarship.dateCreated | date : 'MMM dd' }}</span>
    </div>
  </div>
</ng-template>
